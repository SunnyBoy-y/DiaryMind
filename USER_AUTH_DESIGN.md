# 用户登录功能设计方案

## 1. 后端设计

### 1.1 用户模型
- 字段：id, username, password, email, created_at, updated_at
- 密码使用bcrypt加密存储
- 使用SQLite数据库（现有项目可能已使用）

### 1.2 API接口设计
- POST /api/auth/register - 用户注册
- POST /api/auth/login - 用户登录
- GET /api/auth/me - 获取当前用户信息
- POST /api/auth/logout - 用户登出

### 1.3 技术栈
- FastAPI
- SQLAlchemy（ORM）
- bcrypt（密码加密）
- JWT（身份验证）

## 2. 前端设计

### 2.1 登录界面
- 用户名/邮箱输入框
- 密码输入框
- 登录按钮
- 注册链接

### 2.2 注册界面
- 用户名输入框
- 邮箱输入框
- 密码输入框
- 确认密码输入框
- 注册按钮
- 登录链接

### 2.3 状态管理
- 使用React Context管理用户登录状态
- 在本地存储中保存JWT令牌

## 3. 实现步骤

### 3.1 后端实现
1. 创建用户模型
2. 实现密码加密和验证
3. 实现JWT令牌生成和验证
4. 实现API路由

### 3.2 前端实现
1. 创建登录和注册组件
2. 实现用户状态管理
3. 添加登录状态检查和保护路由
4. 集成到现有应用中

## 4. AI+日记前言用法

### 4.1 功能描述
- 当用户创建新日记时，AI自动生成个性化前言
- 前言内容基于用户的历史日记、当前心情、日期等信息
- 用户可以选择使用、修改或忽略AI生成的前言

### 4.2 实现方案
1. 后端添加生成前言的API接口
2. 前端在创建日记时调用该接口
3. 提供前言编辑和使用选项

### 4.3 API设计
- POST /api/diary/generate-intro - 生成日记前言
  - 参数：user_id, date, mood(可选), tags(可选)
  - 返回：generated_intro

## 5. 集成到现有系统

### 5.1 后端集成
- 在api_utli.py中添加auth路由
- 创建新的auth_api.py文件
- 更新数据库配置

### 5.2 前端集成
- 在App.jsx中添加用户状态管理
- 创建Login和Register组件
- 在路由中添加登录检查

## 6. 测试计划

### 6.1 后端测试
- 测试用户注册功能
- 测试用户登录功能
- 测试JWT令牌验证
- 测试生成前言功能

### 6.2 前端测试
- 测试登录界面功能
- 测试注册界面功能
- 测试用户状态管理
- 测试AI前言生成功能